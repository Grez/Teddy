<!DOCTYPE html>
<html>
<head>

	<meta name="description" content="Simplest possible examples of HTML, CSS and JavaScript." />
	<meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
	<meta itemprop="name" content="simpl.info: simplest possible examples of HTML, CSS and JavaScript">
	<meta itemprop="image" content="/icon_192x192.png">
	<meta name="mobile-web-app-capable" content="yes">
	<meta id="theme-color" name="theme-color" content="#fff">

	<base target="_blank">

	<title>getUserMedia</title>

	<style>
		video {
			object-fit: cover;
		}
		@media screen and (min-width: 1000px) {
			video {
				width: 307px;
				height: 250px;
				background: rgba(255,255,255,0.5);
				border: 1px solid #ccc;
			}

			img {
				height: 480px;
			}
		}

		.grayscale {
		 +filter: grayscale(1);
		}
		.sepia {
		 +filter: sepia(1);
		}
		.blur {
		 +filter: blur(3px);
		}
	</style>

</head>

<body>

<div id="container">

	<h1><a href="../index.html" title="simpl.info home page">simpl.info</a> getUserMedia</h1>

	<video autoplay></video>
	<img src="">
	<canvas style="display:none;"></canvas>

	<p>The <code>MediaStream</code> object <code>stream</code> passed to the <code>getUserMedia()</code> callback in this demo is in global scope, so you can inspect it from the console.</p>

	<p>For more information, see <a href="http://www.html5rocks.com/en/tutorials/getusermedia/intro/" title="Media capture article by Eric Bidelman on HTML5 Rocks">Capturing Audio &amp; Video in HTML5</a> on HTML5 Rocks.</p>

	<a href="https://github.com/samdutton/simpl/blob/gh-pages/getusermedia/index.html" title="View source for this page on GitHub" id="viewSource">View source on GitHub</a>

</div>

<script>
	'use strict';

	function hasGetUserMedia() {
		return !!(navigator.getUserMedia || navigator.webkitGetUserMedia ||
		navigator.mozGetUserMedia || navigator.msGetUserMedia);
	}

	if (!hasGetUserMedia()) {
		console.log('Your browser doesn\'t support GetUserMedia');
	}

	navigator.getUserMedia = navigator.getUserMedia ||
			navigator.webkitGetUserMedia || navigator.mozGetUserMedia;

	var constraints = {
		audio: true,
		video: true
	};
	var video = document.querySelector('video');
	var canvas = document.querySelector('canvas');
	var ctx = canvas.getContext('2d');
	var localMediaStream = null;

	function successCallback(stream) {
		window.stream = stream; // stream available to console
		localMediaStream = stream;
		if (window.URL) {
			video.src = window.URL.createObjectURL(stream);
		} else {
			video.src = stream;
		}
	}

	var idx = 0;
	var filters = ['grayscale', 'sepia', 'blur'];
//	, 'brightness',
//		'contrast', 'hue-rotate', 'hue-rotate2',
//		'hue-rotate3', 'saturate', 'invert', ''];

	function changeFilter(e) {
		var el = e.target;
		el.className = '';
		var effect = filters[idx++ % filters.length]; // loop through filters.
		console.log(effect);
		if (effect) {
			el.classList.add(effect);
		}
	}

	document.querySelector('video').addEventListener('click', changeFilter, false);

	function errorCallback(error) {
		console.log('navigator.getUserMedia error: ', error);
	}

	navigator.getUserMedia(constraints, successCallback, errorCallback);
</script>

</body>
</html>
